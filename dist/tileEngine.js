kontra.tileEngine=function(t){let e=t.width*t.tilewidth,a=t.height*t.tileheight,i=document.createElement("canvas"),s=i.getContext("2d");i.width=e,i.height=a;let r={},n={},h=Object.assign({mapwidth:e,mapheight:a,_sx:0,_sy:0,get sx(){return this._sx},get sy(){return this._sy},set sx(t){this._sx=Math.min(Math.max(0,t),e-kontra.canvas.width)},set sy(t){this._sy=Math.min(Math.max(0,t),a-kontra.canvas.height)},render(){d(i)},renderLayer(t){let i=n[t],s=r[t];i||((i=document.createElement("canvas")).width=e,i.height=a,n[t]=i,h._r(s,i.getContext("2d"))),d(i)},layerCollidesWith(t,e){let a=o(e.y),i=l(e.x),s=o(e.y+e.height),n=l(e.x+e.width),h=r[t];for(let t=a;t<=s;t++)for(let e=i;e<=n;e++)if(h.data[e+t*this.width])return!0;return!1},tileAtLayer(t,e){let a=e.row||o(e.y),i=e.col||l(e.x);return r[t]?r[t].data[i+a*h.width]:-1},_r:function(t,e){e.save(),e.globalAlpha=t.opacity,t.data.forEach((t,a)=>{if(!t)return;let i;for(let e=h.tilesets.length-1;e>=0&&(i=h.tilesets[e],!(t/i.firstgid>=1));e--);let s=i.tilewidth||h.tilewidth,r=i.tileheight||h.tileheight,n=i.margin||0,o=i.image,l=t-i.firstgid,d=i.columns||o.width/(s+n)|0,g=a%h.width*s,c=(a/h.width|0)*r,w=l%d*(s+n),m=(l/d|0)*(r+n);e.drawImage(o,w,m,s,r,g,c,s,r)}),e.restore()}},t);function o(t){return(h.sy+t)/h.tileheight|0}function l(t){return(h.sx+t)/h.tilewidth|0}function d(t){(h.context||kontra.context).drawImage(t,h.sx,h.sy,kontra.canvas.width,kontra.canvas.height,0,0,kontra.canvas.width,kontra.canvas.height)}return h.tilesets.forEach(e=>{let a=(kontra.assets?kontra.assets._d.get(t):"")||window.location.href;if(e.source){let t=kontra.assets.data[kontra.assets._u(e.source,a)];Object.keys(t).forEach(a=>{e[a]=t[a]})}if(""+e.image===e.image){let t=kontra.assets.images[kontra.assets._u(e.image,a)];e.image=t}}),h.layers&&h.layers.forEach(t=>{r[t.name]=t,!1!==t.visible&&h._r(t,s)}),h};